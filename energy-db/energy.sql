DROP TABLE IF EXISTS registration_info;
DROP TABLE IF EXISTS appliances;
DROP TABLE IF EXISTS smart_meter_data;
DROP TABLE IF EXISTS co2_intensity;


CREATE TABLE registration_info
  (
    registration_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(150) NOT NULL UNIQUE,
    password VARCHAR(64) NOT NULL,
    house_size INTEGER, 
    postcode VARCHAR(7) NOT NULL,
    region VARCHAR(30) NOT NULL,
    provider VARCHAR(50),
    api_key VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, 
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
  );

  CREATE TABLE appliances 
  (
    appliance_id BIGINT GENERATED ALWAYS AS IDENTITY, 
    registration_id BIGINT,
    washing_machine BOOLEAN,
    dryer BOOLEAN,
    electric_vehicle BOOLEAN,
    laptops BOOLEAN,
    desktop_computer BOOLEAN,
    fridge BOOLEAN,
    freezer BOOLEAN,
    PRIMARY KEY (appliance_id)
  );

  CREATE TABLE smart_meter_data 
  (
    datatime_id BIGINT GENERATED ALWAYS AS IDENTITY,
    registration_id BIGINT,
    consumption FLOAT,
    start_datetime TIMESTAMP,
    end_datetime TIMESTAMP,
    PRIMARY KEY(datatime_id)
  );

  CREATE TABLE co2_intensity
  (
    co2_intensity_id BIGINT GENERATED ALWAYS AS IDENTITY,
    registration_id BIGINT,
    co2_start_datetime TIMESTAMP,
    co2_end_datetime TIMESTAMP,
    co2_intensity INTEGER,
    PRIMARY KEY(co2_intensity_id)
  );

  CREATE TABLE current_energy_sources 
  (
    energy_id BIGINT GENERATED ALWAYS AS IDENTITY,
    biomass float,
    coal float, 
    imports float,
    gas float, 
    nuclear float, 
    other float,
    hydro float,
    solar float, 
    wind float
  );




-- update registration_info updated_at
CREATE OR REPLACE FUNCTION update_timestamp() 
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_registration_info
BEFORE UPDATE ON registration_info
FOR EACH ROW 
EXECUTE FUNCTION update_timestamp();

INSERT INTO registration_info (name, username, email, password, house_size, postcode, region, provider, api_key, created_at, updated_at) 
VALUES
('John Doe', 'johndoe', 'johndoe@example.com', '$2b$10$WoP3NXT3j2iSJfCB3iSWguqddO3FUffoilTDYrZhnclYEDeBVqoKG', 120, '1234567', 'England', 'Provider A', 'APIKEY12345', '2024-02-25 00:00:00', '2024-02-25 00:00:00'),
('Jane Smith', 'janesmith', 'janesmith@example.com', '$2b$10$WoP3NXT3j2iSJfCB3iSWguqddO3FUffoilTDYrZhnclYEDeBVqoKG', 95, '7654321', 'Scotland', 'Provider B', 'APIKEY67890', '2024-02-25 00:00:00', '2024-02-25 00:00:00');


INSERT INTO appliances (registration_id, washing_machine, dryer, electric_vehicle, laptops, desktop_computer, fridge, freezer) 
VALUES
(1, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE),
(2, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE);

INSERT INTO current_energy_sources (biomass, coal, imports, gas, nuclear, other, hydro, solar, wind)
VALUES 
(4, 0, 10.3, 59.7, 0.9, 0, 0, 15.8, 9.3);



INSERT INTO co2_intensity (registration_id, co2_start_datetime, co2_end_datetime, co2_intensity) 
VALUES
(1, '2025-02-22T00:00Z', '2025-02-22T00:30Z', 150),
(1, '2025-02-22T00:30Z', '2025-02-22T01:00Z', 152),
(1, '2025-02-22T01:00Z', '2025-02-22T01:30Z', 154),
(1, '2025-02-22T01:30Z', '2025-02-22T02:00Z', 156),
(1, '2025-02-22T02:00Z', '2025-02-22T02:30Z', 158),
(1, '2025-02-22T02:30Z', '2025-02-22T03:00Z', 160),
(1, '2025-02-22T03:00Z', '2025-02-22T03:30Z', 162),
(1, '2025-02-22T03:30Z', '2025-02-22T04:00Z', 164),
(1, '2025-02-22T04:00Z', '2025-02-22T04:30Z', 166),
(1, '2025-02-22T04:30Z', '2025-02-22T05:00Z', 168),
(1, '2025-02-22T05:00Z', '2025-02-22T05:30Z', 170),
(1, '2025-02-22T05:30Z', '2025-02-22T06:00Z', 172),
(1, '2025-02-22T06:00Z', '2025-02-22T06:30Z', 174),
(1, '2025-02-22T06:30Z', '2025-02-22T07:00Z', 176),
(1, '2025-02-22T07:00Z', '2025-02-22T07:30Z', 178),
(1, '2025-02-22T07:30Z', '2025-02-22T08:00Z', 180),
(1, '2025-02-22T08:00Z', '2025-02-22T08:30Z', 182),
(1, '2025-02-22T08:30Z', '2025-02-22T09:00Z', 184),
(1, '2025-02-22T09:00Z', '2025-02-22T09:30Z', 186),
(1, '2025-02-22T09:30Z', '2025-02-22T10:00Z', 188),
(1, '2025-02-22T10:00Z', '2025-02-22T10:30Z', 190),
(1, '2025-02-22T10:30Z', '2025-02-22T11:00Z', 192),
(1, '2025-02-22T11:00Z', '2025-02-22T11:30Z', 194),
(1, '2025-02-22T11:30Z', '2025-02-22T12:00Z', 196),
(1, '2025-02-22T12:00Z', '2025-02-22T12:30Z', 198),
(1, '2025-02-22T12:30Z', '2025-02-22T13:00Z', 200),
(1, '2025-02-22T13:00Z', '2025-02-22T13:30Z', 202),
(1, '2025-02-22T13:30Z', '2025-02-22T14:00Z', 204),
(1, '2025-02-22T14:00Z', '2025-02-22T14:30Z', 206),
(1, '2025-02-22T14:30Z', '2025-02-22T15:00Z', 208),
(1, '2025-02-22T15:00Z', '2025-02-22T15:30Z', 210),
(1, '2025-02-22T15:30Z', '2025-02-22T16:00Z', 212),
(1, '2025-02-22T16:00Z', '2025-02-22T16:30Z', 214),
(1, '2025-02-22T16:30Z', '2025-02-22T17:00Z', 216),
(1, '2025-02-22T17:00Z', '2025-02-22T17:30Z', 218),
(1, '2025-02-22T17:30Z', '2025-02-22T18:00Z', 220),
(2, '2025-02-22T00:00Z', '2025-02-22T00:30Z', 100),
(2, '2025-02-22T00:30Z', '2025-02-22T01:00Z', 101),
(2, '2025-02-22T01:00Z', '2025-02-22T01:30Z', 102),
(2, '2025-02-22T01:30Z', '2025-02-22T02:00Z', 103),
(2, '2025-02-22T02:00Z', '2025-02-22T02:30Z', 104),
(2, '2025-02-22T02:30Z', '2025-02-22T03:00Z', 105),
(2, '2025-02-22T03:00Z', '2025-02-22T03:30Z', 106),
(2, '2025-02-22T03:30Z', '2025-02-22T04:00Z', 107),
(2, '2025-02-22T04:00Z', '2025-02-22T04:30Z', 108),
(2, '2025-02-22T04:30Z', '2025-02-22T05:00Z', 109),
(2, '2025-02-22T05:00Z', '2025-02-22T05:30Z', 110),
(2, '2025-02-22T05:30Z', '2025-02-22T06:00Z', 111),
(2, '2025-02-22T06:00Z', '2025-02-22T06:30Z', 112),
(2, '2025-02-22T06:30Z', '2025-02-22T07:00Z', 113),
(2, '2025-02-22T07:00Z', '2025-02-22T07:30Z', 114),
(2, '2025-02-22T07:30Z', '2025-02-22T08:00Z', 115),
(2, '2025-02-22T08:00Z', '2025-02-22T08:30Z', 116),
(2, '2025-02-22T08:30Z', '2025-02-22T09:00Z', 117),
(2, '2025-02-22T09:00Z', '2025-02-22T09:30Z', 118),
(2, '2025-02-22T09:30Z', '2025-02-22T10:00Z', 119),
(2, '2025-02-22T10:00Z', '2025-02-22T10:30Z', 120),
(2, '2025-02-22T10:30Z', '2025-02-22T11:00Z', 121),
(2, '2025-02-22T11:00Z', '2025-02-22T11:30Z', 122),
(2, '2025-02-22T11:30Z', '2025-02-22T12:00Z', 123),
(2, '2025-02-22T12:00Z', '2025-02-22T12:30Z', 124),
(2, '2025-02-22T12:30Z', '2025-02-22T13:00Z', 125),
(2, '2025-02-22T13:00Z', '2025-02-22T13:30Z', 126),
(2, '2025-02-22T13:30Z', '2025-02-22T14:00Z', 127),
(2, '2025-02-22T14:00Z', '2025-02-22T14:30Z', 128),
(2, '2025-02-22T14:30Z', '2025-02-22T15:00Z', 129),
(2, '2025-02-22T15:00Z', '2025-02-22T15:30Z', 130),
(2, '2025-02-22T15:30Z', '2025-02-22T16:00Z', 131),
(2, '2025-02-22T16:00Z', '2025-02-22T16:30Z', 132),
(2, '2025-02-22T16:30Z', '2025-02-22T17:00Z', 133),
(2, '2025-02-22T17:00Z', '2025-02-22T17:30Z', 134),
(2, '2025-02-22T17:30Z', '2025-02-22T18:00Z', 135),
(2, '2025-02-22T18:00Z', '2025-02-22T18:30Z', 136),
(2, '2025-02-22T18:30Z', '2025-02-22T19:00Z', 137),
(2, '2025-02-22T19:00Z', '2025-02-22T19:30Z', 138),
(2, '2025-02-22T19:30Z', '2025-02-22T20:00Z', 139),
(2, '2025-02-22T20:00Z', '2025-02-22T20:30Z', 140),
(2, '2025-02-22T20:30Z', '2025-02-22T21:00Z', 141),
(2, '2025-02-22T21:00Z', '2025-02-22T21:30Z', 142),
(2, '2025-02-22T21:30Z', '2025-02-22T22:00Z', 143),
(2, '2025-02-22T22:00Z', '2025-02-22T22:30Z', 144),
(2, '2025-02-22T22:30Z', '2025-02-22T23:00Z', 145),
(2, '2025-02-22T23:00Z', '2025-02-22T23:30Z', 146),
(2, '2025-02-22T23:30Z', '2025-02-23T00:00Z', 147);



INSERT INTO smart_meter_data (registration_id, consumption, start_datetime, end_datetime)
VALUES
(1, 0.12, '2025-02-22T00:00:00+00:00', '2025-02-22T00:30:00+00:00'),
(1, 0.45, '2025-02-22T00:30:00+00:00', '2025-02-22T01:00:00+00:00'),
(1, 1.02, '2025-02-22T01:00:00+00:00', '2025-02-22T01:30:00+00:00'),
(1, 0.88, '2025-02-22T01:30:00+00:00', '2025-02-22T02:00:00+00:00'),
(1, 0.76, '2025-02-22T02:00:00+00:00', '2025-02-22T02:30:00+00:00'),
(1, 1.25, '2025-02-22T02:30:00+00:00', '2025-02-22T03:00:00+00:00'),
(1, 0.67, '2025-02-22T03:00:00+00:00', '2025-02-22T03:30:00+00:00'),
(1, 1.12, '2025-02-22T03:30:00+00:00', '2025-02-22T04:00:00+00:00'),
(1, 0.54, '2025-02-22T04:00:00+00:00', '2025-02-22T04:30:00+00:00'),
(1, 1.37, '2025-02-22T04:30:00+00:00', '2025-02-22T05:00:00+00:00'),
(1, 0.96, '2025-02-22T05:00:00+00:00', '2025-02-22T05:30:00+00:00'),
(1, 0.84, '2025-02-22T05:30:00+00:00', '2025-02-22T06:00:00+00:00'),
(1, 0.55, '2025-02-22T06:00:00+00:00', '2025-02-22T06:30:00+00:00'),
(1, 1.20, '2025-02-22T06:30:00+00:00', '2025-02-22T07:00:00+00:00'),
(1, 0.74, '2025-02-22T07:00:00+00:00', '2025-02-22T07:30:00+00:00'),
(1, 1.05, '2025-02-22T07:30:00+00:00', '2025-02-22T08:00:00+00:00'),
(1, 0.91, '2025-02-22T08:00:00+00:00', '2025-02-22T08:30:00+00:00'),
(1, 0.68, '2025-02-22T08:30:00+00:00', '2025-02-22T09:00:00+00:00'),
(1, 1.30, '2025-02-22T09:00:00+00:00', '2025-02-22T09:30:00+00:00'),
(1, 0.79, '2025-02-22T09:30:00+00:00', '2025-02-22T10:00:00+00:00'),
(1, 1.18, '2025-02-22T10:00:00+00:00', '2025-02-22T10:30:00+00:00'),
(1, 0.62, '2025-02-22T10:30:00+00:00', '2025-02-22T11:00:00+00:00'),
(1, 1.09, '2025-02-22T11:00:00+00:00', '2025-02-22T11:30:00+00:00'),
(1, 0.93, '2025-02-22T11:30:00+00:00', '2025-02-22T12:00:00+00:00'),
(1, 0.75, '2025-02-22T12:00:00+00:00', '2025-02-22T12:30:00+00:00'),
(1, 1.28, '2025-02-22T12:30:00+00:00', '2025-02-22T13:00:00+00:00'),
(1, 0.89, '2025-02-22T13:00:00+00:00', '2025-02-22T13:30:00+00:00'),
(1, 1.15, '2025-02-22T13:30:00+00:00', '2025-02-22T14:00:00+00:00'),
(1, 0.71, '2025-02-22T14:00:00+00:00', '2025-02-22T14:30:00+00:00'),
(1, 1.33, '2025-02-22T14:30:00+00:00', '2025-02-22T15:00:00+00:00'),
(1, 0.58, '2025-02-22T15:00:00+00:00', '2025-02-22T15:30:00+00:00'),
(1, 1.07, '2025-02-22T15:30:00+00:00', '2025-02-22T16:00:00+00:00'),
(1, 0.99, '2025-02-22T16:00:00+00:00', '2025-02-22T16:30:00+00:00'),
(1, 0.65, '2025-02-22T16:30:00+00:00', '2025-02-22T17:00:00+00:00'),
(1, 1.36, '2025-02-22T17:00:00+00:00', '2025-02-22T17:30:00+00:00'),
(1, 0.80, '2025-02-22T17:30:00+00:00', '2025-02-22T18:00:00+00:00'),
(1, 1.24, '2025-02-22T18:00:00+00:00', '2025-02-22T18:30:00+00:00'),
(1, 0.59, '2025-02-22T18:30:00+00:00', '2025-02-22T19:00:00+00:00'),
(1, 1.12, '2025-02-22T19:00:00+00:00', '2025-02-22T19:30:00+00:00'),
(1, 1.05, '2025-02-22T19:30:00+00:00', '2025-02-22T20:00:00+00:00'),
(2, 0.98, '2025-02-22T00:00:00+00:00', '2025-02-22T00:30:00+00:00'),
(2, 0.66, '2025-02-22T00:30:00+00:00', '2025-02-22T01:00:00+00:00'),
(2, 1.11, '2025-02-22T01:00:00+00:00', '2025-02-22T01:30:00+00:00'),
(2, 0.78, '2025-02-22T01:30:00+00:00', '2025-02-22T02:00:00+00:00'),
(2, 0.93, '2025-02-22T02:00:00+00:00', '2025-02-22T02:30:00+00:00'),
(2, 1.04, '2025-02-22T02:30:00+00:00', '2025-02-22T03:00:00+00:00'),
(2, 0.71, '2025-02-22T03:00:00+00:00', '2025-02-22T03:30:00+00:00'),
(2, 1.30, '2025-02-22T03:30:00+00:00', '2025-02-22T04:00:00+00:00'),
(2, 0.56, '2025-02-22T04:00:00+00:00', '2025-02-22T04:30:00+00:00'),
(2, 1.22, '2025-02-22T04:30:00+00:00', '2025-02-22T05:00:00+00:00'),
(2, 1.02, '2025-02-22T05:00:00+00:00', '2025-02-22T05:30:00+00:00'),
(2, 0.88, '2025-02-22T05:30:00+00:00', '2025-02-22T06:00:00+00:00'),
(2, 0.49, '2025-02-22T06:00:00+00:00', '2025-02-22T06:30:00+00:00'),
(2, 1.10, '2025-02-22T06:30:00+00:00', '2025-02-22T07:00:00+00:00'),
(2, 0.72, '2025-02-22T07:00:00+00:00', '2025-02-22T07:30:00+00:00'),
(2, 1.09, '2025-02-22T07:30:00+00:00', '2025-02-22T08:00:00+00:00'),
(2, 0.85, '2025-02-22T08:00:00+00:00', '2025-02-22T08:30:00+00:00'),
(2, 0.62, '2025-02-22T08:30:00+00:00', '2025-02-22T09:00:00+00:00'),
(2, 1.34, '2025-02-22T09:00:00+00:00', '2025-02-22T09:30:00+00:00'),
(2, 0.77, '2025-02-22T09:30:00+00:00', '2025-02-22T10:00:00+00:00'),
(2, 1.25, '2025-02-22T10:00:00+00:00', '2025-02-22T10:30:00+00:00'),
(2, 0.58, '2025-02-22T10:30:00+00:00', '2025-02-22T11:00:00+00:00'),
(2, 1.06, '2025-02-22T11:00:00+00:00', '2025-02-22T11:30:00+00:00'),
(2, 0.91, '2025-02-22T11:30:00+00:00', '2025-02-22T12:00:00+00:00'),
(2, 0.72, '2025-02-22T12:00:00+00:00', '2025-02-22T12:30:00+00:00'),
(2, 1.28, '2025-02-22T12:30:00+00:00', '2025-02-22T13:00:00+00:00'),
(2, 0.87, '2025-02-22T13:00:00+00:00', '2025-02-22T13:30:00+00:00'),
(2, 1.14, '2025-02-22T13:30:00+00:00', '2025-02-22T14:00:00+00:00'),
(2, 0.68, '2025-02-22T14:00:00+00:00', '2025-02-22T14:30:00+00:00'),
(2, 1.35, '2025-02-22T14:30:00+00:00', '2025-02-22T15:00:00+00:00'),
(2, 0.53, '2025-02-22T15:00:00+00:00', '2025-02-22T15:30:00+00:00'),
(2, 1.04, '2025-02-22T15:30:00+00:00', '2025-02-22T16:00:00+00:00'),
(2, 0.96, '2025-02-22T16:00:00+00:00', '2025-02-22T16:30:00+00:00'),
(2, 0.63, '2025-02-22T16:30:00+00:00', '2025-02-22T17:00:00+00:00'),
(2, 1.38, '2025-02-22T17:00:00+00:00', '2025-02-22T17:30:00+00:00'),
(2, 0.75, '2025-02-22T17:30:00+00:00', '2025-02-22T18:00:00+00:00'),
(2, 1.21, '2025-02-22T18:00:00+00:00', '2025-02-22T18:30:00+00:00'),
(2, 0.57, '2025-02-22T18:30:00+00:00', '2025-02-22T19:00:00+00:00'),
(2, 1.08, '2025-02-22T19:00:00+00:00', '2025-02-22T19:30:00+00:00'),
(2, 1.02, '2025-02-22T19:30:00+00:00', '2025-02-22T20:00:00+00:00');


